---
title: "Calculating Median Age at Death and Modal Age at Death with Decimals"
author: ''
date: '2021-12-19'
output:
  html_document:
    df_print: paged
  pdf_document: default
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2021-12-19T11:35:45+02:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
slug: MedianMode
---



<div id="background" class="section level1">
<h1>Background</h1>
<p>Longevity is often measured through time trends in the mean age at death (MAD). In addition to MAD, there are two other interesting metrics, which can be calculated from life table functions. Namely, the median age at death and the modal age at death. The former refers to the age when half of the population has died, while the latter defines the age where most deaths are observed. Demographers are often interested in analyzing these two figures with decimals precision. In the previous literature, several methods for this purpose have been proposed. I selected some of them and provide R functions, enabling researchers to calculate the median age at death and the modal age at death with decimals points. To the best of my knowledge, there are currently no R functions on this topic. So, please feel free to improve and extent this work. As mentioned above, I focus on methods that can be applied to life table functions. For simplicity, I do not consider methods using smoothed death rates (smoothing age-specific death counts with the corresponding exposure as offsets and deriving death rates).</p>
</div>
<div id="calculating-the-median-age-at-death-with-decimals" class="section level1">
<h1>Calculating the Median Age at Death with Decimals</h1>
<p>One method for calculating the median age at death has been described by Canudas-Romo (2010) wich is based on the work of Kannisto (2001). My Rcode focuses on equation A1 in Canudas-Romo (2010),
<span class="math display">\[
Median(t) = x + \frac{[0.5 - l(x,t)]}{[l(x+1, t) - l(x,t)]},
\]</span>
where <span class="math inline">\(l(x,t)\)</span> denotes the life table survivorship function in time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span> and <span class="math inline">\(x+1\)</span> correspond to the ages surrounding the median age at death, i.e., the exact age where <span class="math inline">\(l(x,t)=0.5\)</span>.
In the following, I will apply this equation to data for the US in R. The period life tables for the USA are downloaded from the <a href="https://mortality.org">HMD</a>.</p>
<pre class="r"><code>setwd(&quot;d:/Rcode/Data/USA&quot;)
LT.women &lt;- read.table(&quot;fltper_1x1.txt&quot;, header=TRUE, skip=2)


### getting the lx function for women in 2019
lx = LT.women$lx[LT.women$Year==2019]
### getting our ages, 0-110
last.age = length(lx)-1
age = 0:last.age
###normalize to 1
Sx = lx/lx[1]
### finding the last age before half of the population has died
x = Sx - 0.5
the.x = which(x==min(x[x&gt;0]))
###applying the formula
Median = age[the.x] + ((0.5 - Sx[the.x]) / (Sx[the.x+1] - Sx[the.x]))

###corresponding function
Median1.fun &lt;- function(lx) {
  
  Sx = lx/lx[1]
  x = Sx - 0.5
  the.x = which(x==min(x[x&gt;0]))
  Median = age[the.x] + ((0.5 - Sx[the.x]) / (Sx[the.x+1] - Sx[the.x]))
  
  return(Median)
}</code></pre>
<p>In addition, I test the performance of modeling the <span class="math inline">\(l(x,t)\)</span> function and predicting it for ages with decimal points. This idea is based on work by Ouellette &amp; Bourbeau (2011) and Horiuchi et al. (2013).</p>
<pre class="r"><code>### using the splinefun
smooth.lx = splinefun(lx ~ age)
###you can modify the &quot;by argument&quot; for smaller age intervals
decimal.lx = smooth.lx(seq(0,age[length(age)], by=0.1))
smooth.Sx = decimal.lx/decimal.lx[1]
x = smooth.Sx - 0.5
the.x = which.min(abs(smooth.Sx - 0.5))
Median = seq(0,110, by=0.1)[the.x]

###corresponding function
Median2.fun &lt;- function(lx) {
  
  last.age = length(lx)-1
  age = 0:last.age
  smooth.lx = splinefun(lx ~ age)
  decimal.lx = smooth.lx(seq(0, age[length(age)], by=0.1))
  smooth.Sx = decimal.lx/decimal.lx[1]
  x = smooth.Sx - 0.5
  the.x = which.min(abs(smooth.Sx - 0.5))
  Median = seq(0, age[length(age)], by=0.1)[the.x]
  
  return(Median)
}


###using loess function
smooth.lx = loess(lx ~ age, span=0.1, degree=2)
decimal.lx = predict(smooth.lx, newdata=seq(0, age[length(age)], by=0.1))
smooth.Sx = decimal.lx/decimal.lx[1]
x = smooth.Sx - 0.5
the.x = which.min(abs(smooth.Sx - 0.5))
Median = seq(0, age[length(age)], by=0.1)[the.x]

###corresponding function
Median3.fun &lt;- function(lx) {

  last.age = length(lx)-1
  age = 0:last.age
  smooth.lx = loess(lx ~ age, span=0.1, degree=2)
  decimal.lx = predict(smooth.lx, newdata=seq(0, age[length(age)], by=0.1))
  smooth.Sx = decimal.lx/decimal.lx[1]
  x = smooth.Sx - 0.5
  the.x = which.min(abs(smooth.Sx - 0.5))
  Median = seq(0, age[length(age)], by=0.1)[the.x]
  
  return(Median)
  
}

###Lets test them out
Median1.fun(lx = LT.women$lx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 85.29959</code></pre>
<pre class="r"><code>Median2.fun(lx = LT.women$lx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 85.3</code></pre>
<pre class="r"><code>Median3.fun(lx = LT.women$lx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 85.3</code></pre>
<p>The results are very similar.</p>
</div>
<div id="calculating-the-modal-age-at-death-with-decimals" class="section level1">
<h1>Calculating the Modal Age at Death with Decimals</h1>
<p>The first method for calculating the modal age at death with decimals is again taken from Canudas-Romo (2010). The equation can be found on page 309 in the paper,
<span class="math display">\[
Modal(t) = x + \frac{[d(x,t)-d(x-1,t)]}{[d(x,t)-d(x-1,t)]+[d(x,t)-d(x+1,t)]},
\]</span>
with <span class="math inline">\(d(x,t)\)</span> being the age-distribution of life tables deaths in time <span class="math inline">\(t\)</span> and age <span class="math inline">\(x\)</span> corresponds to the age where most deaths occur.</p>
<pre class="r"><code>###getting data for US women in 2019
dx = LT.women$dx[LT.women$Year==2019]
### finding the age with highest number of deaths
the.x = which.max(dx)
###applying the formula
Mode = age[the.x] - 0.5 + (dx[the.x] - dx[the.x-1]) / 
  ( (dx[the.x] - dx[the.x-1]) + (dx[the.x] - dx[the.x+1]) )

###corresponding function
Mode1.fun &lt;- function(dx) {

  last.age = length(dx)-1
  age = 0:last.age
  the.x = which.max(dx)
  Mode = age[the.x] - 0.5 + (dx[the.x] - dx[the.x-1]) / 
    ( (dx[the.x] - dx[the.x-1]) + (dx[the.x] - dx[the.x+1]) )

  return(Mode)  
}</code></pre>
<p>Again, the other two methods are based on smoothing age-specific death distributions and predicting deaths for small age intervals. While the first approach uses the optimization function in order to obtain the modal age at death with decimal precision (Ouellette &amp; Bourbeau 2011; Ebeling, Rau, and Baudisch 2018), the second uses R’s loess() function.</p>
<pre class="r"><code>### I do not consider infant mortality
smooth.dx = splinefun(dx[-1] ~ age[-1])
max.opt = optimize(smooth.dx, interval = c(30, 110), maximum = T)
Mode = max.opt$maximum

###corresponding function
Mode2.fun &lt;- function(dx) {

  last.age = length(dx)-1
  age = 0:last.age
  smooth.dx = splinefun(dx[-1] ~ age[-1])
  max.opt = optimize(smooth.dx, interval = c(30, 110), maximum = T)
  Mode = max.opt$maximum
  
  return(Mode)
}

### The loess approach, again no infant mortality considered
loess.smooth.dx = loess(dx[-1] ~ age[-1], span=0.1, degree = 2)
y = predict(loess.smooth.dx, newdata = seq(1, age[length(age)], by=0.1))
Mode = seq(1, age[length(age)], by=0.1)[which.max(y)]

###the corresponding function
Mode3.fun &lt;- function(dx) {

  loess.smooth.dx = loess(dx[-1] ~ age[-1], span=0.1, degree = 2)
  y = predict(loess.smooth.dx, newdata = seq(1, age[length(age)], by=0.1))
  Mode = seq(1, age[length(age)], by=0.1)[which.max(y)]

  return(Mode)  
}

###Lets test it out
Mode1.fun(dx = LT.women$dx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 88.65847</code></pre>
<pre class="r"><code>Mode2.fun(dx = LT.women$dx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 88.74962</code></pre>
<pre class="r"><code>Mode3.fun(dx = LT.women$dx[LT.women$Year==2019])</code></pre>
<pre><code>## [1] 88.6</code></pre>
</div>
<div id="two-general-function-for-the-median-age-at-death-and-the-modal-age-at-death" class="section level1">
<h1>Two General Function for the Median Age at Death and the Modal Age at Death</h1>
<p>Finally, I provide two general functions where the method can be selected through the function argument “method”.</p>
<pre class="r"><code>MedianAge &lt;- function(lx, method = c(&quot;formula&quot;, &quot;spline&quot;, &quot;loess&quot;)) {
    
  if (method == &quot;formula&quot;) {
    out &lt;- Median1.fun(lx)
  }
  
  if (method == &quot;spline&quot;) {
    out &lt;- Median2.fun(lx)
  }
  
  if (method == &quot;loess&quot;) {
    out &lt;- Median3.fun(lx)
  }
  
  return(out)
}

ModeAge &lt;- function(dx, method = c(&quot;formula&quot;, &quot;spline&quot;, &quot;loess&quot;)) {
  
  if (method == &quot;formula&quot;) {
    out &lt;- Mode1.fun(dx)
  }
  
  if (method == &quot;spline&quot;) {
    out &lt;- Mode2.fun(dx)
  }
  
  if (method == &quot;loess&quot;) {
    out &lt;- Mode3.fun(dx)
  }
  
  return(out)
}

###Lets test them

Median.1 &lt;- c()
Median.2 &lt;- c()
Median.3 &lt;- c()

Modal.1 &lt;- c()
Modal.2 &lt;- c()
Modal.3 &lt;- c()

for (i in 1:length(1990:2019)) {
  
Median.1[i] &lt;- MedianAge(lx = LT.women$lx[LT.women$Year==1989+i], method=&quot;formula&quot;)
Median.2[i] &lt;- MedianAge(lx = LT.women$lx[LT.women$Year==1989+i], method=&quot;spline&quot;)
Median.3[i] &lt;- MedianAge(lx = LT.women$lx[LT.women$Year==1989+i], method=&quot;loess&quot;)

Modal.1[i] &lt;- ModeAge(dx = LT.women$dx[LT.women$Year==1989+i], method=&quot;formula&quot;)
Modal.2[i] &lt;- ModeAge(dx = LT.women$dx[LT.women$Year==1989+i], method=&quot;spline&quot;)
Modal.3[i] &lt;- ModeAge(dx = LT.women$dx[LT.women$Year==1989+i], method=&quot;loess&quot;)

}</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/Fig1-1.png" width="960" /><img src="{{< blogdown/postref >}}index.en_files/figure-html/Fig1-2.png" width="960" />
The results suggest that all three methods produce similar results for the median age at death. For the modal age at death, method “formula” corresponds to the “spline” approach. The “loess” method, however, can lead to considerably different results.</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ul>
<li><p>Canudas-Romo, V. (2010). Three Measures of Longevity: Time Trends and Record Values. <strong>Demography</strong> 47(2):299–312.</p></li>
<li><p>Ebeling, M.; Rau, R.; Baudisch, A. (2018). Rectangularization of the survival curve reconsidered: The maximum inner rectangle approach. <strong>Population Studies</strong> 72(3):369-379.</p></li>
<li><p>Horiuchi, S.; Ouellette, N.; Cheung, S.L.K, and Robine, J.-M. Modal age at death: lifespan indicator in the era of longevity extension. <strong>Vienna Yearbook of Population Research 2013</strong>, pp. 37-69.</p></li>
<li><p>Kannisto, V. (2001). Mode and Dispersion of the Length of Life. <strong>Population: An English Selection</strong>13:159–71.</p></li>
<li><p>Ouellette, N. and Bourbeau, R. (2011). Changes in the age-at-death distribution in four low mortality countries: A nonparametric approach. <strong>Demographic Research</strong> 25(19):95-628.</p></li>
</ul>
</div>
